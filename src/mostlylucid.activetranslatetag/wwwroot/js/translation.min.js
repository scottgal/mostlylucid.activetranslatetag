class HtmlTextExtractor{static containsHtml(t){return!!t&&/<[^>]+>/.test(t)}static extractText(t){if(!t)return"";const e=document.createElement("div");return e.innerHTML=t,e.querySelectorAll("script, style").forEach(t=>t.remove()),e.textContent||e.innerText||""}static extractWithPlaceholders(t){if(!t||!this.containsHtml(t))return{plainText:t||"",placeholders:[]};const e=[];let n=t,a=0;n=n.replace(/<(img|br|hr|input)[^>]*\/?>/gi,t=>{const n=`{#${a}#}`;return e.push({index:a,originalHtml:t,placeholder:n,isInline:!0}),a++,n});n=n.replace(/<[^>]+>/g,t=>{const n=`{#${a}#}`;return e.push({index:a,originalHtml:t,placeholder:n,isInline:!1}),a++,n});const i=document.createElement("div");i.innerHTML=n;return{plainText:i.textContent||i.innerText||"",placeholders:e}}static reinjectHtml(t,e){if(!t||!e||0===e.length)return t||"";let n=t;for(const t of e)n=n.replace(t.placeholder,t.originalHtml);return n}static stripHtmlForTranslation(t){if(!this.containsHtml(t))return{cleanText:t,tagMap:{}};const e={};let n=t,a=0;n=n.replace(/<[^>]+>/g,t=>{const n=`__TAG${a}__`;return e[n]=t,a++,n});const i=document.createElement("div");i.innerHTML=n;return{cleanText:(i.textContent||i.innerText||"").trim(),tagMap:e}}static restoreHtmlAfterTranslation(t,e){if(!t||!e||0===Object.keys(e).length)return t||"";let n=t;for(const[t,a]of Object.entries(e))n=n.replace(t,a);return n}}class TranslationManager{constructor(){this.currentLanguage=this.getCurrentLanguage(),this.isTranslating=!1}getCurrentLanguage(){const t=`; ${document.cookie}`.split("; preferred-language=");return 2===t.length?t.pop().split(";").shift():"en"}collectTranslationKeys(){const t=document.querySelectorAll("[data-translate-key]");return Array.from(t).map(t=>t.getAttribute("data-translate-key"))}async switchLanguageHtmx(t){if(!this.isTranslating)try{this.isTranslating=!0,this.showLoadingIndicator();const e=this.collectTranslationKeys();if(0===e.length)return console.log("No translatable content on this page"),this.currentLanguage=t,void(document.cookie=`preferred-language=${t}; path=/; max-age=31536000; SameSite=Lax`);const n=new FormData;e.forEach(t=>n.append("keys",t));const a=await fetch(`/Language/Switch/${t}`,{method:"POST",body:n});if(!a.ok)throw new Error("Failed to switch language");const i=await a.text(),r=document.createElement("div");r.innerHTML=i,r.querySelectorAll("[hx-swap-oob]").forEach(t=>{const e=t.id,n=document.getElementById(e);n&&(n.innerHTML=t.innerHTML,n.style.transition="opacity 0.15s",n.style.opacity="0.8",setTimeout(()=>{n.style.opacity="1"},75))}),this.currentLanguage=t,console.log(`Language switched to ${t} (${e.length} elements updated)`)}catch(t){console.error("Error switching language:",t)}finally{this.isTranslating=!1,this.hideLoadingIndicator()}}async switchLanguage(t){if(t!==this.currentLanguage)return"en"===t?(document.cookie="preferred-language=en; path=/; max-age=31536000; SameSite=Lax",void window.location.reload()):void await this.switchLanguageHtmx(t)}showLoadingIndicator(){let t=document.getElementById("translation-loading");t?t.style.display="block":(t=document.createElement("div"),t.id="translation-loading",t.className="toast toast-center",t.innerHTML='\n                <div class="alert alert-info">\n                    <span class="loading loading-spinner loading-sm"></span>\n                    <span>Loading translations...</span>\n                </div>\n            ',document.body.appendChild(t))}hideLoadingIndicator(){const t=document.getElementById("translation-loading");t&&setTimeout(()=>{t.style.display="none"},300)}initialize(){const t=document.getElementById("current-lang");t&&(t.textContent=this.currentLanguage.toUpperCase());const e=this.currentLanguage||"en";e&&"en"!==e.toLowerCase()&&setTimeout(()=>{this.switchLanguageHtmx(e)},0),console.log(`Translation system initialized (current language: ${this.currentLanguage})`)}}window.translationManager=new TranslationManager,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.translationManager.initialize()}):window.translationManager.initialize(),window.setLanguage=function(t){window.translationManager.switchLanguage(t)},window.HtmlTextExtractor=HtmlTextExtractor;