!function(t){"use strict";class n{constructor(t={}){this.currentLanguage=this.getCurrentLanguage(),this.isTranslating=!1,this.debug=t.debug||!1,this.signalRHub=t.signalRHub||"/hubs/translation",this.enableNotifications=!1!==t.enableNotifications,this.signalRConnection=null,this.debug&&console.log("[Translation] Initializing with options:",t)}getCurrentLanguage(){const t=`; ${document.cookie}`.split("; preferred-language=");return 2===t.length?t.pop().split(";").shift():"en"}collectTranslationKeys(){const t=document.querySelectorAll("[data-translate-key]");return Array.from(t).map(t=>t.getAttribute("data-translate-key"))}async switchLanguageHtmx(t){if(this.isTranslating)this.debug&&console.log("[Translation] Already translating, ignoring request");else try{this.isTranslating=!0,this.showLoadingIndicator();const n=this.collectTranslationKeys();if(0===n.length)return this.debug&&console.log("[Translation] No translatable content on this page"),this.currentLanguage=t,document.cookie=`preferred-language=${t}; path=/; max-age=31536000; SameSite=Lax`,void this.updateCurrentLanguageDisplay(t);const e=new FormData;n.forEach(t=>e.append("keys",t));const a=await fetch(`/Language/Switch/${t}`,{method:"POST",body:e});if(!a.ok)throw new Error(`Failed to switch language: ${a.statusText}`);const i=await a.text(),s=document.createElement("div");s.innerHTML=i;let o=0;s.querySelectorAll("[hx-swap-oob]").forEach(t=>{const n=t.id,e=document.getElementById(n);e&&(e.innerHTML=t.innerHTML,this.animateTranslationUpdate(e),o++)}),this.currentLanguage=t,this.updateCurrentLanguageDisplay(t),this.debug&&console.log(`[Translation] Language switched to ${t} (${o}/${n.length} elements updated)`),this.enableNotifications&&this.showNotification(`Language changed to ${this.getLanguageName(t)}`,"success")}catch(t){console.error("[Translation] Error switching language:",t),this.enableNotifications&&this.showNotification("Failed to switch language","error")}finally{this.isTranslating=!1,this.hideLoadingIndicator()}}async switchLanguage(n){if(n!==this.currentLanguage)return"en"===n?(document.cookie="preferred-language=en; path=/; max-age=31536000; SameSite=Lax",void t.location.reload()):void await this.switchLanguageHtmx(n);this.debug&&console.log("[Translation] Already in this language")}animateTranslationUpdate(t){t.style.transition="background-color 0.5s ease",t.style.backgroundColor="#ffffcc",setTimeout(()=>{t.style.backgroundColor="",setTimeout(()=>{t.style.transition=""},500)},500)}updateCurrentLanguageDisplay(t){document.querySelectorAll("#current-lang, [data-current-lang]").forEach(n=>{try{n.textContent=(t||"en").toUpperCase()}catch{n.textContent=t}})}showLoadingIndicator(){document.querySelectorAll("#translation-loading-indicator, [data-translation-loading]").forEach(t=>t.classList.remove("d-none"));let t=document.getElementById("translation-loading");t?t.style.display="block":(t=document.createElement("div"),t.id="translation-loading",t.className="toast-container position-fixed top-0 end-0 p-3",t.innerHTML='\n                    <div class="toast show" role="alert">\n                        <div class="toast-body d-flex align-items-center gap-2">\n                            <div class="spinner-border spinner-border-sm" role="status">\n                                <span class="visually-hidden">Loading...</span>\n                            </div>\n                            <span>Loading translations...</span>\n                        </div>\n                    </div>\n                ',document.body.appendChild(t))}hideLoadingIndicator(){document.querySelectorAll("#translation-loading-indicator, [data-translation-loading]").forEach(t=>t.classList.add("d-none"));const t=document.getElementById("translation-loading");t&&setTimeout(()=>{t.style.display="none"},300)}showNotification(t,n="info"){const e=document.getElementById("translation-notifications")||this.createNotificationContainer(),a=document.createElement("div");a.className=`alert alert-${"error"===n?"danger":"success"===n?"success":"info"} alert-dismissible fade show`,a.innerHTML=`\n                ${t}\n                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n            `,e.appendChild(a),setTimeout(()=>{a.classList.remove("show"),setTimeout(()=>a.remove(),150)},3e3)}createNotificationContainer(){const t=document.createElement("div");return t.id="translation-notifications",t.className="position-fixed top-0 end-0 p-3",t.style.zIndex="1060",document.body.appendChild(t),t}getLanguageName(t){return{en:"English",es:"Español",fr:"Français",de:"Deutsch",it:"Italiano",pt:"Português",ru:"Русский",ja:"日本語",ko:"한국어",zh:"中文",ar:"العربية",hi:"हिन्दी"}[t.toLowerCase()]||(t||"en").toUpperCase()}initializeSignalR(){if(!1!==(t.translationConfig||{}).enableSignalR)if("undefined"!=typeof signalR)try{if(t.__translationHubConnected)return void(this.debug&&console.log("[Translation] SignalR already initialized"));this.signalRConnection=(new signalR.HubConnectionBuilder).withUrl(this.signalRHub).withAutomaticReconnect().build(),this.signalRConnection.on("StringTranslated",t=>{this.debug&&console.log("[Translation] String translated:",t);const n=`t-${this.simpleHash(t.key)}`,e=document.getElementById(n);e&&t.languageCode===this.currentLanguage&&(e.innerHTML=t.translatedText,this.animateTranslationUpdate(e))}),this.signalRConnection.on("TranslationProgress",t=>{this.debug&&console.log("[Translation] Progress:",t),this.updateProgressToast(t)}),this.signalRConnection.on("TranslationComplete",t=>{this.debug&&console.log("[Translation] Complete:",t),this.hideProgressToast(!0),this.enableNotifications&&this.showNotification(`${t.translatedCount} translations completed`,"success")}),this.signalRConnection.start().then(()=>{t.__translationHubConnected=!0,this.debug&&console.log("[Translation] SignalR connected")}).catch(t=>{console.error("[Translation] SignalR connection error:",t)})}catch(t){console.error("[Translation] Error initializing SignalR:",t)}else this.debug&&console.warn("[Translation] SignalR not available, skipping real-time updates");else this.debug&&console.warn("[Translation] SignalR disabled by config")}ensureProgressToast(){if("1"===sessionStorage.getItem("translationToastDismissed"))return null;let t=document.getElementById("translation-progress-toast");if(t)return t;const n=document.createElement("div");n.id="translation-progress-toast",n.className="position-fixed bottom-0 end-0 p-3",n.style.zIndex="1060",n.style.maxWidth="360px",n.setAttribute("role","status"),n.setAttribute("aria-live","polite"),n.innerHTML='\n                <div class="toast show" style="min-width:280px;" data-bs-autohide="false">\n                    <div class="toast-header">\n                        <strong class="me-auto">Translating…</strong>\n                        <small id="translation-progress-text">0 / 0 (0%)</small>\n                        <button type="button" class="btn-close ms-2 mb-1" aria-label="Close"></button>\n                    </div>\n                    <div class="toast-body">\n                        <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100">\n                            <div class="progress-bar" id="translation-progress-bar" style="width: 0%"></div>\n                        </div>\n                        <div class="mt-2 small text-muted" id="translation-progress-current"></div>\n                    </div>\n                </div>',document.body.appendChild(n);const e=n.querySelector(".btn-close");return e?.addEventListener("click",()=>{sessionStorage.setItem("translationToastDismissed","1"),n.remove()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&(sessionStorage.setItem("translationToastDismissed","1"),n.remove())},{once:!0}),n}updateProgressToast(t){const n=this.ensureProgressToast();if(!n)return;const e=n.querySelector("#translation-progress-bar"),a=n.querySelector("#translation-progress-text"),i=n.querySelector("#translation-progress-current");e&&(e.style.width=`${t.percentage}%`),a&&(a.textContent=`${t.completed} / ${t.total} (${Math.round(t.percentage)}%)`),i&&(i.textContent=t.currentKey?`Current: ${t.currentKey}`:"")}hideProgressToast(t=!1){const n=document.getElementById("translation-progress-toast");if(n){if(t){const t=n.querySelector(".toast-header .me-auto");t&&(t.textContent="Translations complete")}setTimeout(()=>{n.remove()},t?1500:300)}}simpleHash(t){let n=0;for(let e=0;e<t.length;e++){n=(n<<5)-n+t.charCodeAt(e),n|=0}return Math.abs(n).toString(16).substring(0,16).padStart(16,"0")}initialize(){this.updateCurrentLanguageDisplay(this.currentLanguage);const t=this.currentLanguage||"en";t&&"en"!==t.toLowerCase()&&setTimeout(()=>{this.switchLanguageHtmx(t)},100),this.initializeSignalR(),this.debug&&console.log(`[Translation] System initialized (language: ${this.currentLanguage})`)}}t.TranslationManager=n;const e=t.translationConfig||{};t.translationManager=new n({debug:e.debug||!1,signalRHub:e.signalRHub||"/hubs/translation",enableNotifications:!1!==e.enableNotifications}),t.TranslationClient={init:function(n={}){null!=n.debug&&(t.translationManager.debug=!!n.debug),n.signalRHub&&(t.translationManager.signalRHub=n.signalRHub),null!=n.enableNotifications&&(t.translationManager.enableNotifications=!!n.enableNotifications);const e=n.defaultLang?String(n.defaultLang):t.translationManager.getCurrentLanguage();"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{t.translationManager.initialize(),e&&"en"!==e.toLowerCase()&&t.translationManager.switchLanguageHtmx(e)},{once:!0}):(t.translationManager.initialize(),e&&"en"!==e.toLowerCase()&&t.translationManager.switchLanguageHtmx(e))},setLanguage:function(n){return t.translationManager.switchLanguage(n)},getCurrentLanguage:function(){return t.translationManager.getCurrentLanguage()},translatePage:function(n){const e=n||t.translationManager.currentLanguage||"en";return t.translationManager.switchLanguageHtmx(e)}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{t.translationManager.initialize()}):t.translationManager.initialize(),t.setLanguage=function(n){t.translationManager.switchLanguage(n)}}(window);